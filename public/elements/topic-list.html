<dom-module id="topic-list">
  <template>
        <iron-ajax auto="" url="/topics" handle-as="json" on-response="topics_response"></iron-ajax>
        <paper-menu selected="0">
            <paper-item on-click="all_questions">All</paper-item>
            <template is="dom-repeat" items="{{topics}}" as="topic">
                <paper-item undefined="{{topic.description}}" on-click="update_questions">
                    <input type="hidden" class="topic_title" value="{{topic.title::input}}">
                </paper-item>
            </template>
        </paper-menu>
    </template>
  <script>
    Polymer({
      is: 'topic-list',
      topics_response: function (event) {
        this.topics = event.detail.response;
      },
      update_questions: function (event) {
        var topic_title = event.currentTarget.children[0].value;
        var req = new XMLHttpRequest();
        req.open('GET', '/questions/ruby/' + topic_title, true);
        req.send();
        req.onload = function () {
          var questions = JSON.parse(this.response);
          for (var i = 0; i < questions.length; i++) {
            questions[i] = questions[i]['question'];
          }
          Polymer.dom(document).querySelector('question-cards').questions = questions;
        };
      },
      all_questions: function (event) {
        var req = new XMLHttpRequest();
        req.open('GET', '/questions/ruby', true);
        req.send();
        req.onload = function () {
          Polymer.dom(document).querySelector('question-cards').questions = JSON.parse(this.response);
        };
      }
    });
  </script>
</dom-module>